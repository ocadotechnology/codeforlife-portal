{# copied from django-recaptcha 2.0.6 #}
{# The provided implementation has been altered to allow multiple Captchas per page. #}
<script src="https://{{ recaptcha_domain }}/recaptcha/api.js?render={{ public_key }}{% if api_params %}&{{ api_params }}{% endif %}"></script>
<script type="text/javascript">
    // Helper function to prevent form submission and execute verification.
    let verifyCaptcha_{{ widget_uuid}} = function(e) {
        e.preventDefault();
        grecaptcha.execute('{{ public_key }}', {action: 'form'})
            .then(function(token) {
                if (!token) {
                    token = "something";
                }
                console.log("reCAPTCHA validated for 'data-widget-uuid=\"{{ widget_uuid }}\"'. Setting input value...")
                let element = document.querySelector('.g-recaptcha[data-widget-uuid="{{ widget_uuid }}"]');
                element.value = token;
                document.querySelector('.g-recaptcha[data-widget-uuid="{{ widget_uuid }}"]').closest('form').submit();
            });
    };

    grecaptcha.ready(function() {
        let element = document.querySelector('.g-recaptcha[data-widget-uuid="{{ widget_uuid }}"]');
        element.closest('form').addEventListener('submit', verifyCaptcha_{{ widget_uuid}});
    });
</script>
